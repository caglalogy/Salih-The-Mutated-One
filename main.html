<body style="height: 100vh; background: #000000; text-align: center; overflow: hidden;">
    <canvas id="c" width="1000" height="1000"></canvas>
    <!-- <input type="file" id="fileInput"> -->
    <script>
        //FILE OKUMA 

        /*let ReadBestScore;
        //let file = "./bestScore.txt";
        document.getElementById('fileInput').addEventListener('change', function selectedFileChanged() {
            const reader = new FileReader();
            reader.onload = function fileReadCompleted() {
                // when the reader is done, the content is in reader.result.
                ReadBestScore = reader.result;
            };
            reader.readAsText(this.files[0]);
        });*/

        
        context = c.getContext("2d");
        // IMAGES
        const car = new Image();
        const apple = new Image();
        const canvas = new Image();
        const mob = new Image();
        const kalp1 = new Image();
        const kalp2 = new Image();
        const kalp3 = new Image();
        car.src = "images/cagla.png";
        apple.src = "images/apple.png";
        canvas.src = "images/salihLevel1.png";
        mob.src = "images/cos.png";
        kalp1.src = "images/kalp1.png";
        kalp2.src = "images/kalp1.png";
        kalp3.src = "images/kalp1.png";
        //MAP
        const level1walls = [
            [50,50],[100,50],[150,50],[200,50],[250,50],
            [50,100],[50,150],[50,200],[50,250],[700,50],
            [750,50],[800,50],[850,50],[900,50],[900,100],
            [900,150],[900,200],[900,250],[50,700],[50,750],[50,800],
            [50,850],[50,900],[100,900],[150,900],[200,900],[250,900],
            [700,900],[750,900],[800,900],[850,900],[900,900],[900,850],
            [900,800],[900,750],[900,700],[300,300],[300,350],[300,400],
            [350,300],[400,300],[550,300],[600,300],[650,300],[650,350],
            [650,400],[300,550],[300,600],[300,650],[350,650],[400,650],
            [550,650],[600,650],[650,650],[650,600],[650,550]
        ]
        function mapCheck([x,y]) {
            var loopEnd = level1walls.length
            var mapMatchCheck = 0;
            for(var a=0; a<loopEnd; a++){
                if(level1walls[a][0] == x && level1walls[a][1] == y){
                    mapMatchCheck = 1;
                }
            }
            if(mapMatchCheck == 1){
                //true: can not go through the wall
                return true;
            } else {
                //false: can go, there are no walls around character.
                return false;
            }
        }
        // GAME ELEMENTS
        var can = 3
        var kalpSize = 30;
        var canvasSize = 1000;
        var interval = 24;
        var score = bestScore = 0;
        var turn = 0;
        var moveNum = 0;
        function randomLocation() {
            return (50 * Math.floor(Math.random()*20));
        }
        // CAHARCTER
        var carX = 500;
        var carY = 500;
        var carSize = 50;
        // APPLE
        spawnApple();
        var appleSize = 30;
        var isAppleGold = false;
        var ateGoldApple = false;
        // MOB
        spawnMob();
        var mobSize = 50;
        var mobCarp = 2;
        function mobMoveChange(){
            return Math.ceil(Math.random()*mobCarp)
        } 
        // FUNCTIONS //
        // move functions
        function onMove(){
            if(mobMoveChange()==1 && ateGoldApple == false){
                mobMove();
            };
            moveNum++;
        }
        // car move functions
        function carLeft() {
            var leftCarX = carX-50;
            if(mapCheck([leftCarX,carY]) == false){
                carX -= 50;
                onMove();
            }
        }
        function carRight() {
            var rightCarX = carX+50;
            if(mapCheck([rightCarX,carY]) == false){
                carX += 50;
                onMove();
            }
        }
        function carUp() {
            var upCarY = carY-50;
            if(mapCheck([carX,upCarY]) == false){
                carY -= 50;
                onMove();
            }
        }
        function carDown() {
            var downCarY = carY+50;
            if(mapCheck([carX,downCarY]) == false){
                carY += 50;
                onMove();
            }
        }
        // mob move functions
        function mobLeft() {
            var leftMobX = mobX-50;
            if(mapCheck([leftMobX,mobY]) == false){
                mobX -= 50;
            }
        }
        function mobRight() {
            var rightMobX = mobX+50;
            if(mapCheck([rightMobX,mobY]) == false){
                mobX += 50;
            }
        }
        function mobUp() {
            var upMobY = mobY-50;
            if(mapCheck([mobX,upMobY]) == false){
                mobY -= 50;
            }
        }
        function mobDown() {
            var downMobY = mobY+50;
            if(mapCheck([mobX,downMobY]) == false){
                mobY += 50;
            }
        }
        function mobMove(){
            var farkX = mobX-carX;          // fark>0 mob sağda, fark<0 ise mob solda
            var farkY = mobY-carY;          // fark>0 mob aşağıda fark<0 mob yukarıda
            
            if(farkX>0 && farkY>0){                 // salih sol üstte
                mobLeft();
                mobUp();
            }  
            else if(farkX>0 && farkY<0){            // salih sol aşağıda
                mobLeft();
                mobDown();
            }
            else if(farkX<0 && farkY>0){            // salih sağ üstte
                mobRight();
                mobUp();
            }
            else if(farkX<0 && farkY<0){            // salih sağ altta
                mobRight();
                mobDown();
            }
            else if(farkX==0 && farkY>0){           // salih yukarda
                mobUp();
            }
            else if(farkX==0 && farkY<0){           // salih aşağıda
                mobDown();
            }
            else if(farkX>0 && farkY==0){           // salih solda
                mobLeft();
            }
            else if(farkX<0 && farkY==0){           // salih sağda
                mobRight();
            }
        }
        // spawn functions
        function spawnApple() {
            //appleX ve appleY'nin koordinatlari duvara denk geldigi surece yeni koordinat ata
            do{
                appleX = randomLocation();
                appleY = randomLocation();
            }
            while(mapCheck([appleX,appleY]) == true);
        }

        function spawnMob() {
            //appleX ve appleY'nin koordinatlari duvara denk geldigi surece yeni koordinat ata
            do{
                mobX = randomLocation();
                mobY = randomLocation();
            }
            while(mapCheck([mobX,mobY]) == true);
        }
        // event functions
        function crossBorder() {
            carX = 500;
            carY = 500;
            spawnApple();
            spawnMob();
            carSize = 50;
            can--;
        }
        function ateApple() {
            score += 1;
            turn ++;
            //carSize += 10;
            if(isAppleGold==true){
                ateGoldApple = true;
            } else {
                ateGoldApple = false;
            }
            spawnApple();
        }
        function eaten() {
            carX = 500;
            carY = 500;
            spawnMob();
            spawnApple();
            can--;
        }

        document.onkeydown = function(e) {
            switch(e.which) {
                case 37: carLeft();                // left
                break;

                case 38: carUp();                   // up
                break;

                case 39: carRight();                // right
                break;

                case 40: carDown();                // down
                break;

                default: 32; // exit this handler for other keys
            }
            e.preventDefault(); // prevent the default action (scroll / move caret)
        };

        setInterval(() => {
            context.fillStyle = "#2f694c";
            context.drawImage(canvas,0,0,canvasSize,canvasSize);
            context.drawImage(apple,appleX,appleY,appleSize,appleSize);
            context.drawImage(car, carX, carY, carSize, carSize);
            context.drawImage(mob, mobX, mobY, mobSize, mobSize);
            context.drawImage(kalp1, 968, 0, kalpSize, kalpSize);
            context.drawImage(kalp2, 936, 0, kalpSize, kalpSize);
            context.drawImage(kalp3, 904, 0, kalpSize, kalpSize);
            context.fillStyle = "black";
            context.font = "20px Verdana";
            context.fillText("Score: " + score, 9, 25);
            bestScore = bestScore < score ? score : bestScore;
            context.fillText("Best Score: " + bestScore, 9,50);
            context.fillText("Move: " + moveNum, 9,100);
            context.fillText("Can: " + can, 9,125);
            context.fillText("Read Best Score : " + ReadBestScore, 9,150);
            //context.fillText("CarX: " + carX + ", CarY: " + carY, 9,75);
            //context.fillText("AppleX: " + appleX + ", AppleY: " + appleY, 9,100);
            // DID YOU EAT THE APPLE
            function eating (carX,carY,appleX,appleY){
                if( (carX == appleX) && (carY == appleY) ){
                    return true;
                } else {
                    return false;
                }
            }
            // IF YOU EAT THE APPLE 
            if (eating(carX,carY,appleX,appleY)){
                ateApple();
            }
            ////////////////////////////////// GOLDEN APPLE
            if(turn != 0 && turn%5 == 0){
                isAppleGold = true;
                apple.src = "images/goldelma.png";
            }else {
                apple.src = "images/apple.png";
                isAppleGold = false;
            }
            // SALİH'S LEGS MOVES
            /*if(moveNum != 0 && moveNum % 2 == 1){
                car.src = "images/salih2.png";
            }
            else{ 
                car.src = "images/salih.png";
            }*/
            // IF YOU TOUCH THE BORDER
            if(carX>960 || carY>960 || carX<0 || carY<0){
                crossBorder();
            }
            // IF MOB CATCH YOU
            if((carX == mobX) && (carY == mobY)){
                eaten();
            }
            // LIFE COUNTING
            if(can==2){
                kalp3.src = "images/kalpsiz.png"
            }
            if(can==1){
                kalp2.src = "images/kalpsiz.png"
            }
            if(can==0){
                kalp3.src = "images/kalp1.png";
                kalp2.src = "images/kalp1.png";
                score = 0;
                can = 3;
                carSize = 50;
                moveNum = 0;
            }
        }, interval)
    </script>
</body>
